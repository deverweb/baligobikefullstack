events {}
http {

	server {
			listen 80;

			server_name deverweb.ru;

			location / {
				proxy_pass http://frontend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
			}

			location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
	}

	server {
		listen 80;
		listen [::]:80;

		server_name admin.deverweb.ru www.admin.deverweb.ru;

		index index.php index.html index.htm;

		root /var/www/html;

		location ~ /.well-known/acme-challenge {
			allow all;
			root /var/www/html;
		}

		location / {
			try_files $uri $uri/ /index.php$is_args$args;
		}
		include /etc/nginx/mime.types;
		# location ~ ^/wp-json/ {
		# 		# if permalinks not enabled
		# 		rewrite ^/wp-json/(.*?)$ /?rest_route=/$1 last;
		# }
		location ~ /\. {
				deny all;
        access_log off;
        log_not_found off;
    }
		location ~ \.php$ {
			try_files $uri =404;
			fastcgi_split_path_info ^(.+\.php)(/.+)$;
			fastcgi_pass wordpress:9000;
			fastcgi_index index.php;
			include fastcgi_params;
			fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_param PATH_INFO $fastcgi_path_info;
		}

		location ~ /\.ht {
			deny all;
		}
		
		location = /favicon.ico { 
			log_not_found off; access_log off; 
		}
		location = /robots.txt { 
			log_not_found off; access_log off; allow all; 
		}
		location ~* \.(css|gif|ico|jpeg|jpg|js|png)$ {
			expires max;
			log_not_found off;
		}
	
}
}